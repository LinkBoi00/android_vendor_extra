From 8036a17b5947993c2bc5141ff48a80e48a85e1e0 Mon Sep 17 00:00:00 2001
From: Jarl-Penguin <jarlpenguin@outlook.com>
Date: Wed, 16 Jun 2021 11:28:46 +0000
Subject: [PATCH 8/9] core: Don't spoof props in recovery mode

Signed-off-by: Jarl-Penguin <jarlpenguin@outlook.com>
Change-Id: Ic3fbabc38fda59a21963b02621baa4328747d738
---
 init/property_service.cpp | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/init/property_service.cpp b/init/property_service.cpp
index 0a4a70e301..fe05a1ef9c 100644
--- a/init/property_service.cpp
+++ b/init/property_service.cpp
@@ -872,7 +872,7 @@ static void workaround_snet_properties() {
     // Bail out if this is recovery, fastbootd, or anything other than a normal boot.
     // fastbootd, in particular, needs the real values so it can allow flashing on
     // unlocked bootloaders.
-    if (!isNormalBoot) {
+    if (!isNormalBoot || IsRecoveryMode()) {
         return;
     }
 
@@ -1252,7 +1252,9 @@ void PropertyLoadBootDefaults() {
     update_sys_usb_config();
 
     // Workaround SafetyNet
-    workaround_snet_properties();
+    if (!IsRecoveryMode()) {
+        workaround_snet_properties();
+    }
 }
 
 bool LoadPropertyInfoFromFile(const std::string& filename,
-- 
2.34.1

